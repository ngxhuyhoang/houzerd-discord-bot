{"version":3,"file":"index.js","sourceRoot":"","sources":["../index.ts"],"names":[],"mappings":"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","sourcesContent":["const Discord = require(\"discord.js\");\nconst ytdl = require(\"ytdl-core\");\nrequire(\"dotenv\").config();\n\nconst prefix = \"hz!\";\n\nconst client = new Discord.Client();\n\nconst queue = new Map();\n\nclient.once(\"ready\", () => {\n  console.log(\"Ready!\");\n});\n\nclient.once(\"reconnecting\", () => {\n  console.log(\"Reconnecting!\");\n});\n\nclient.once(\"disconnect\", () => {\n  console.log(\"Disconnect!\");\n});\n\nclient.on(\"message\", async (message) => {\n  if (message.author.bot) return;\n  if (!message.content.startsWith(prefix)) return;\n\n  const serverQueue = queue.get(message.guild.id);\n\n  if (message.content.startsWith(`${prefix}play`)) {\n    execute(message, serverQueue);\n    return;\n  } else if (message.content.startsWith(`${prefix}skip`)) {\n    skip(message, serverQueue);\n    return;\n  } else if (message.content.startsWith(`${prefix}stop`)) {\n    stop(message, serverQueue);\n    return;\n  } else {\n    message.channel.send(\"Sai lệnh rồi\");\n  }\n});\n\nasync function execute(message, serverQueue) {\n  const args = message.content.split(\" \");\n\n  const voiceChannel = message.member.voice.channel;\n  if (!voiceChannel)\n    return message.channel.send(\n      \"Chưa vào voice channel thì sao nghe làm sao được mà mở nhạc\"\n    );\n  const permissions = voiceChannel.permissionsFor(message.client.user);\n  if (!permissions.has(\"CONNECT\") || !permissions.has(\"SPEAK\")) {\n    return message.channel.send(\"Cấp quyền để tôi vào và phát âm thanh\");\n  }\n\n  const songInfo = await ytdl.getInfo(args[1]);\n  const song: { title: string; url: string } = {\n    title: songInfo.videoDetails.title,\n    url: songInfo.videoDetails.video_url,\n  };\n\n  if (!serverQueue) {\n    const queueContruct: {\n      textChannel: any;\n      voiceChannel: any;\n      connection: null;\n      songs: any[];\n      volume: number;\n      playing: boolean;\n    } = {\n      textChannel: message.channel,\n      voiceChannel: voiceChannel,\n      connection: null,\n      songs: [],\n      volume: 5,\n      playing: true,\n    };\n\n    queue.set(message.guild.id, queueContruct);\n\n    queueContruct.songs.push(song);\n\n    try {\n      var connection = await voiceChannel.join();\n      queueContruct.connection = connection;\n      play(message.guild, queueContruct.songs[0]);\n    } catch (err) {\n      console.log(err);\n      queue.delete(message.guild.id);\n      return message.channel.send(err);\n    }\n  } else {\n    serverQueue.songs.push(song);\n    return message.channel.send(`Đã thêm ${song.title} vào list nhạc`);\n  }\n}\n\nfunction skip(message, serverQueue) {\n  if (!message.member.voice.channel)\n    return message.channel.send(\n      \"Không có ở trong voice channel thì không stop được\"\n    );\n  if (!serverQueue) return message.channel.send(\"Làm gì có nhạc mà skip\");\n  serverQueue.connection.dispatcher.end();\n}\n\nfunction stop(message, serverQueue) {\n  if (!message.member.voice.channel)\n    return message.channel.send(\n      \"Không có ở trong voice channel thì không stop được\"\n    );\n\n  if (!serverQueue) return message.channel.send(\"Làm gì có nhạc mà dừng\");\n\n  serverQueue.songs = [];\n  serverQueue.connection.dispatcher.end();\n}\n\nfunction play(guild, song) {\n  const serverQueue = queue.get(guild.id);\n  if (!song) {\n    serverQueue.voiceChannel.leave();\n    queue.delete(guild.id);\n    return;\n  }\n\n  const dispatcher = serverQueue.connection\n    .play(ytdl(song.url))\n    .on(\"finish\", () => {\n      serverQueue.songs.shift();\n      play(guild, serverQueue.songs[0]);\n    })\n    .on(\"error\", (error) => console.error(error));\n  dispatcher.setVolumeLogarithmic(serverQueue.volume / 5);\n  serverQueue.textChannel.send(`Đang mở: **${song.title}**`);\n}\n\nclient.login(process.env.token);\n"]}